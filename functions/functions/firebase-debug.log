[debug] [2025-03-21T01:28:12.623Z] ----------------------------------------------------------------------
[debug] [2025-03-21T01:28:12.624Z] Command:       /Users/miyakoshiyuuki/.nvm/versions/node/v18.20.7/bin/node /Users/miyakoshiyuuki/.nvm/versions/node/v18.20.7/bin/firebase functions:shell
[debug] [2025-03-21T01:28:12.624Z] CLI Version:   13.34.0
[debug] [2025-03-21T01:28:12.624Z] Platform:      darwin
[debug] [2025-03-21T01:28:12.624Z] Node Version:  v18.20.7
[debug] [2025-03-21T01:28:12.627Z] Time:          Fri Mar 21 2025 10:28:12 GMT+0900 (日本標準時)
[debug] [2025-03-21T01:28:12.627Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-03-21T01:28:12.720Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-03-21T01:28:12.720Z] > authorizing via signed-in user (youki.miya0511@gmail.com)
[debug] [2025-03-21T01:28:12.720Z] [iam] checking project lesson-manager-99ab9 for permissions ["firebase.projects.get"]
[debug] [2025-03-21T01:28:12.721Z] Checked if tokens are valid: true, expires at: 1742523354232
[debug] [2025-03-21T01:28:12.721Z] Checked if tokens are valid: true, expires at: 1742523354232
[debug] [2025-03-21T01:28:12.722Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/lesson-manager-99ab9:testIamPermissions [none]
[debug] [2025-03-21T01:28:12.722Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/lesson-manager-99ab9:testIamPermissions x-goog-quota-user=projects/lesson-manager-99ab9
[debug] [2025-03-21T01:28:12.722Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/lesson-manager-99ab9:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2025-03-21T01:28:13.698Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/lesson-manager-99ab9:testIamPermissions 200
[debug] [2025-03-21T01:28:13.698Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/lesson-manager-99ab9:testIamPermissions {"permissions":["firebase.projects.get"]}
[warn] ⚠  functions: Functions Emulator unable to start on port 5000, starting on 5001 instead. {"metadata":{"emulator":{"name":"functions"},"message":"Functions Emulator unable to start on port 5000, starting on 5001 instead."}}
[debug] [2025-03-21T01:28:13.858Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-03-21T01:28:13.860Z] defaultcredentials: writing to file /Users/miyakoshiyuuki/.config/firebase/youki_miya0511_gmail.com_application_default_credentials.json
[debug] [2025-03-21T01:28:13.861Z] DEBUG: Setting GAC to /Users/miyakoshiyuuki/.config/firebase/youki_miya0511_gmail.com_application_default_credentials.json
[debug] [2025-03-21T01:28:13.861Z] Checked if tokens are valid: true, expires at: 1742523354232
[debug] [2025-03-21T01:28:13.861Z] Checked if tokens are valid: true, expires at: 1742523354232
[debug] [2025-03-21T01:28:13.861Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/lesson-manager-99ab9/adminSdkConfig [none]
[debug] [2025-03-21T01:28:14.562Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/lesson-manager-99ab9/adminSdkConfig 200
[debug] [2025-03-21T01:28:14.563Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/lesson-manager-99ab9/adminSdkConfig {"projectId":"lesson-manager-99ab9","storageBucket":"lesson-manager-99ab9.firebasestorage.app"}
[debug] [2025-03-21T01:28:14.581Z] [functions] Watching "/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions" for Cloud Functions...
[debug] [2025-03-21T01:28:14.585Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:28:15.132Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:28:15.132Z] Building nodejs source
[debug] [2025-03-21T01:28:15.132Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:28:15.133Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:28:15.139Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8541

[debug] [2025-03-21T01:28:15.435Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:28:15.448Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:28:15.448Z] [functions[us-central1-healthCheck]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/healthCheck).
[debug] [2025-03-21T01:28:15.448Z] addStorageTrigger {"eventTrigger":{"eventType":"google.storage.object.finalize","resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"}}
[debug] [2025-03-21T01:28:15.448Z] [functions[us-central1-processAudioFile]] storage function initialized.
[debug] [2025-03-21T01:28:15.448Z] [functions[us-central1-createLessonSummary]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/createLessonSummary).
[debug] [2025-03-21T01:28:15.448Z] [functions[us-central1-testStorageAccess]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/testStorageAccess).
[debug] [2025-03-21T01:28:15.448Z] [functions[us-central1-testDifyAPI]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/testDifyAPI).
[info] i  functions: Loaded functions: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI 
[warn] ⚠  functions: The following emulators are not running, calls to these services will affect production: firestore, database, pubsub, storage, eventarc, tasks 
[debug] [2025-03-21T01:35:23.126Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:35:24.128Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:35:25.111Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:35:25.111Z] Building nodejs source
[debug] [2025-03-21T01:35:25.112Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:35:25.112Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:35:25.113Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8120

[debug] [2025-03-21T01:35:25.427Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:35:25.435Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:35:39.955Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:35:39.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:35:40.957Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:35:41.364Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:35:41.364Z] Building nodejs source
[debug] [2025-03-21T01:35:41.364Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:35:41.364Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:35:41.365Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8333

[debug] [2025-03-21T01:35:41.615Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:35:41.621Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:37:58.817Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:37:59.820Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:00.277Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:00.277Z] Building nodejs source
[debug] [2025-03-21T01:38:00.277Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:00.278Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:00.279Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8875

[debug] [2025-03-21T01:38:00.594Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:00.601Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:38:08.864Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:38:09.866Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:10.271Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:10.271Z] Building nodejs source
[debug] [2025-03-21T01:38:10.271Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:10.271Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:10.272Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8635

[debug] [2025-03-21T01:38:10.527Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:10.535Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:38:25.114Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:38:26.115Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:26.538Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:26.539Z] Building nodejs source
[debug] [2025-03-21T01:38:26.539Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:26.539Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:26.540Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8140

[debug] [2025-03-21T01:38:26.789Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:26.794Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:38:34.743Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:38:35.746Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:36.183Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:36.183Z] Building nodejs source
[debug] [2025-03-21T01:38:36.183Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:36.184Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:36.185Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8073

[debug] [2025-03-21T01:38:36.485Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:36.491Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:38:43.357Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:38:44.359Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:44.777Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:44.777Z] Building nodejs source
[debug] [2025-03-21T01:38:44.777Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:44.778Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:44.778Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8516

[debug] [2025-03-21T01:38:45.028Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:45.035Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:38:55.478Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:38:56.480Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:38:56.873Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:38:56.873Z] Building nodejs source
[debug] [2025-03-21T01:38:56.873Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:38:56.873Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:38:56.874Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8787

[debug] [2025-03-21T01:38:57.127Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:38:57.134Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:43:39.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:43:40.265Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:43:41.106Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:43:41.106Z] Building nodejs source
[debug] [2025-03-21T01:43:41.106Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:43:41.106Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:43:41.107Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8329

[debug] [2025-03-21T01:43:41.414Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:43:41.420Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:43:48.583Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:43:49.584Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:43:50.009Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:43:50.009Z] Building nodejs source
[debug] [2025-03-21T01:43:50.009Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:43:50.009Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:43:50.010Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8069

[debug] [2025-03-21T01:43:50.306Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:43:50.318Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:43:58.388Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:43:59.390Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:43:59.809Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:43:59.809Z] Building nodejs source
[debug] [2025-03-21T01:43:59.809Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:43:59.810Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:43:59.810Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8949

[debug] [2025-03-21T01:44:00.077Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:44:00.083Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:44:06.375Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:44:07.377Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:44:07.830Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:44:07.830Z] Building nodejs source
[debug] [2025-03-21T01:44:07.830Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:44:07.830Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:44:07.831Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8046

[debug] [2025-03-21T01:44:08.084Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:44:08.090Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:44:15.204Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:44:16.207Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:44:16.671Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:44:16.671Z] Building nodejs source
[debug] [2025-03-21T01:44:16.671Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:44:16.672Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:44:16.672Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8349

[debug] [2025-03-21T01:44:16.971Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:44:16.977Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:44:27.582Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:44:28.584Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:44:28.986Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:44:28.986Z] Building nodejs source
[debug] [2025-03-21T01:44:28.986Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:44:28.986Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:44:28.987Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8844

[debug] [2025-03-21T01:44:29.237Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:44:29.243Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:44:38.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:44:38.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:44:38.990Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:44:39.991Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:44:40.367Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:44:40.367Z] Building nodejs source
[debug] [2025-03-21T01:44:40.367Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:44:40.367Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:44:40.368Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8280

[debug] [2025-03-21T01:44:40.630Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:44:40.636Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:50:28.802Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:50:29.805Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:50:30.645Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:50:30.645Z] Building nodejs source
[debug] [2025-03-21T01:50:30.645Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:50:30.645Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:50:30.647Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8579

[debug] [2025-03-21T01:50:30.953Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:50:30.960Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:50:37.716Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:50:38.718Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:50:39.130Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:50:39.130Z] Building nodejs source
[debug] [2025-03-21T01:50:39.130Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:50:39.130Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:50:39.131Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8058

[debug] [2025-03-21T01:50:39.375Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:50:39.383Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:50:47.109Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:50:48.111Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:50:48.523Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:50:48.523Z] Building nodejs source
[debug] [2025-03-21T01:50:48.523Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:50:48.523Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:50:48.524Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8747

[debug] [2025-03-21T01:50:48.775Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:50:48.780Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:51:02.852Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:51:02.853Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:51:03.855Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:51:04.284Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:51:04.284Z] Building nodejs source
[debug] [2025-03-21T01:51:04.284Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:51:04.285Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:51:04.286Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8104

[debug] [2025-03-21T01:51:04.588Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:51:04.596Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:54:43.102Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:54:44.107Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:54:45.091Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:54:45.091Z] Building nodejs source
[debug] [2025-03-21T01:54:45.091Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:54:45.092Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:54:45.093Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8102

[debug] [2025-03-21T01:54:45.401Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:54:45.407Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:54:57.310Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:54:58.311Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:54:58.723Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:54:58.723Z] Building nodejs source
[debug] [2025-03-21T01:54:58.723Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:54:58.724Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:54:58.724Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8125

[debug] [2025-03-21T01:54:58.975Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:54:58.981Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:07.296Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:55:08.298Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:55:08.725Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:55:08.725Z] Building nodejs source
[debug] [2025-03-21T01:55:08.725Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:55:08.726Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:55:08.727Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8019

[debug] [2025-03-21T01:55:08.978Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:55:08.985Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:16.297Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:55:17.300Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:55:17.745Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:55:17.745Z] Building nodejs source
[debug] [2025-03-21T01:55:17.745Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:55:17.745Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:55:17.746Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8538

[debug] [2025-03-21T01:55:18.017Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:55:18.022Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:27.029Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:55:28.032Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:55:28.466Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:55:28.466Z] Building nodejs source
[debug] [2025-03-21T01:55:28.466Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:55:28.467Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:55:28.467Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8994

[debug] [2025-03-21T01:55:28.753Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:55:28.761Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:35.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:55:36.733Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:55:37.141Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:55:37.141Z] Building nodejs source
[debug] [2025-03-21T01:55:37.141Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:55:37.142Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:55:37.142Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8980

[debug] [2025-03-21T01:55:37.387Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:55:37.393Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:45.620Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T01:55:46.622Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:55:47.042Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:55:47.042Z] Building nodejs source
[debug] [2025-03-21T01:55:47.042Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:55:47.043Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:55:47.043Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8971

[debug] [2025-03-21T01:55:47.292Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:55:47.298Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:55:59.564Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:55:59.564Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:55:59.565Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:00.566Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:56:00.961Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:56:00.962Z] Building nodejs source
[debug] [2025-03-21T01:56:00.962Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:56:00.962Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:56:00.963Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8937

[debug] [2025-03-21T01:56:01.247Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:56:01.252Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:56:08.738Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:56:09.740Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:56:10.147Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:56:10.147Z] Building nodejs source
[debug] [2025-03-21T01:56:10.147Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:56:10.147Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:56:10.148Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8049

[debug] [2025-03-21T01:56:10.393Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:56:10.399Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:56:18.122Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:19.124Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:56:19.522Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:56:19.522Z] Building nodejs source
[debug] [2025-03-21T01:56:19.522Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:56:19.523Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:56:19.523Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8546

[debug] [2025-03-21T01:56:19.769Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:56:19.775Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:56:25.987Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T01:56:26.989Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:56:27.436Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:56:27.436Z] Building nodejs source
[debug] [2025-03-21T01:56:27.436Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:56:27.437Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:56:27.437Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8673

[debug] [2025-03-21T01:56:27.693Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:56:27.699Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T01:56:36.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T01:56:36.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T01:56:36.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T01:56:37.119Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T01:56:37.539Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T01:56:37.539Z] Building nodejs source
[debug] [2025-03-21T01:56:37.539Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T01:56:37.541Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T01:56:37.542Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8350

[debug] [2025-03-21T01:56:37.816Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T01:56:37.823Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:01:31.094Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:01:32.098Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:01:33.090Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:01:33.090Z] Building nodejs source
[debug] [2025-03-21T02:01:33.090Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:01:33.091Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:01:33.092Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8829

[debug] [2025-03-21T02:01:33.414Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:01:33.421Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:01:41.472Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T02:01:42.473Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:01:42.895Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:01:42.895Z] Building nodejs source
[debug] [2025-03-21T02:01:42.895Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:01:42.895Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:01:42.896Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8443

[debug] [2025-03-21T02:01:43.151Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:01:43.156Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:01:54.404Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T02:01:54.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T02:01:55.406Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:01:55.788Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:01:55.788Z] Building nodejs source
[debug] [2025-03-21T02:01:55.788Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:01:55.788Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:01:55.789Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8212

[debug] [2025-03-21T02:01:56.036Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:01:56.042Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:01.560Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:05:02.564Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:05:03.092Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:05:03.092Z] Building nodejs source
[debug] [2025-03-21T02:05:03.092Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:05:03.092Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:05:03.093Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8023

[debug] [2025-03-21T02:05:03.395Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:05:03.400Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:11.066Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:05:12.068Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:05:12.508Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:05:12.508Z] Building nodejs source
[debug] [2025-03-21T02:05:12.508Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:05:12.508Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:05:12.509Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8505

[debug] [2025-03-21T02:05:12.755Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:05:12.761Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:22.394Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T02:05:23.396Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:05:23.799Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:05:23.799Z] Building nodejs source
[debug] [2025-03-21T02:05:23.799Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:05:23.800Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:05:23.800Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8842

[debug] [2025-03-21T02:05:24.121Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:05:24.127Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:31.876Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T02:05:32.880Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:05:33.319Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:05:33.319Z] Building nodejs source
[debug] [2025-03-21T02:05:33.319Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:05:33.319Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:05:33.320Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8465

[debug] [2025-03-21T02:05:33.572Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:05:33.579Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:41.797Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:05:42.800Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:05:43.199Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:05:43.199Z] Building nodejs source
[debug] [2025-03-21T02:05:43.199Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:05:43.201Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:05:43.202Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8732

[debug] [2025-03-21T02:05:43.502Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:05:43.508Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:05:58.158Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:05:59.160Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:06:00.139Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:06:00.139Z] Building nodejs source
[debug] [2025-03-21T02:06:00.139Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:06:00.140Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:06:00.141Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8298

[debug] [2025-03-21T02:06:00.449Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:06:00.456Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:06:07.005Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:06:08.009Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:06:08.427Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:06:08.427Z] Building nodejs source
[debug] [2025-03-21T02:06:08.427Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:06:08.427Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:06:08.428Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8873

[debug] [2025-03-21T02:06:08.675Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:06:08.681Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:06:16.608Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T02:06:17.610Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:06:18.036Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:06:18.036Z] Building nodejs source
[debug] [2025-03-21T02:06:18.036Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:06:18.037Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:06:18.037Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8192

[debug] [2025-03-21T02:06:18.334Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:06:18.340Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T02:06:28.731Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T02:06:29.733Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:06:30.130Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:06:30.130Z] Building nodejs source
[debug] [2025-03-21T02:06:30.130Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:06:30.130Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:06:30.131Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8231

[debug] [2025-03-21T02:06:30.376Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:06:30.382Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:10:38.626Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:10:39.631Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:10:40.076Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:10:40.076Z] Building nodejs source
[debug] [2025-03-21T02:10:40.076Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:10:40.076Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:10:40.077Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8216

[debug] [2025-03-21T02:10:40.382Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:10:40.388Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:10:59.169Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:11:00.171Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:11:00.575Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:11:00.575Z] Building nodejs source
[debug] [2025-03-21T02:11:00.575Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:11:00.576Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:11:00.576Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8034

[debug] [2025-03-21T02:11:00.823Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:11:00.829Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T02:11:12.293Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T02:11:13.298Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T02:11:14.084Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T02:11:14.084Z] Building nodejs source
[debug] [2025-03-21T02:11:14.084Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T02:11:14.085Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T02:11:14.086Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8747

[debug] [2025-03-21T02:11:14.388Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T02:11:14.398Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:52:12.861Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:52:13.869Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:52:14.433Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:52:14.433Z] Building nodejs source
[debug] [2025-03-21T07:52:14.433Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:52:14.434Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:52:14.435Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8059

[debug] [2025-03-21T07:52:14.770Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:52:14.776Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:52:24.531Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:52:25.533Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:52:25.914Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:52:25.914Z] Building nodejs source
[debug] [2025-03-21T07:52:25.914Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:52:25.915Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:52:25.915Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8542

[debug] [2025-03-21T07:52:26.164Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:52:26.171Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:52:45.127Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:52:46.133Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:52:46.594Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:52:46.594Z] Building nodejs source
[debug] [2025-03-21T07:52:46.594Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:52:46.595Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:52:46.596Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8563

[debug] [2025-03-21T07:52:46.850Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:52:46.856Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:52:59.721Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:53:00.724Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:53:01.179Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:53:01.179Z] Building nodejs source
[debug] [2025-03-21T07:53:01.179Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:53:01.180Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:53:01.181Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8982

[debug] [2025-03-21T07:53:01.527Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:53:01.533Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:53:10.367Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:53:11.369Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:53:11.822Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:53:11.822Z] Building nodejs source
[debug] [2025-03-21T07:53:11.822Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:53:11.822Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:53:11.823Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8496

[debug] [2025-03-21T07:53:12.075Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:53:12.081Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:53:23.135Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:53:24.139Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:53:25.219Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:53:25.219Z] Building nodejs source
[debug] [2025-03-21T07:53:25.219Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:53:25.220Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:53:25.221Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8133

[debug] [2025-03-21T07:53:25.493Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:53:25.500Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI.
[debug] [2025-03-21T07:53:34.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T07:53:34.100Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T07:53:35.104Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:53:35.512Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:53:35.512Z] Building nodejs source
[debug] [2025-03-21T07:53:35.512Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:53:35.513Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:53:35.514Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8549

[error] TypeError: express is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:51:13)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T07:53:35.791Z] Got response code 400; body Failed to generate manifest from function source: TypeError: express is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T07:54:09.864Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:54:10.867Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:54:11.491Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:54:11.491Z] Building nodejs source
[debug] [2025-03-21T07:54:11.491Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:54:11.492Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:54:11.492Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8062

[error] TypeError: express is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:51:13)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T07:54:11.770Z] Got response code 400; body Failed to generate manifest from function source: TypeError: express is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T07:54:22.388Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:54:23.390Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:54:23.776Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:54:23.776Z] Building nodejs source
[debug] [2025-03-21T07:54:23.776Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:54:23.776Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:54:23.776Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8987

[error] TypeError: express is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:51:13)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T07:54:24.070Z] Got response code 400; body Failed to generate manifest from function source: TypeError: express is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T07:54:35.614Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:54:36.616Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:54:37.032Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:54:37.032Z] Building nodejs source
[debug] [2025-03-21T07:54:37.032Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:54:37.032Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:54:37.033Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8750

[error] TypeError: express is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:51:13)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T07:54:37.284Z] Got response code 400; body Failed to generate manifest from function source: TypeError: express is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T07:54:45.620Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:54:46.624Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:54:47.085Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:54:47.085Z] Building nodejs source
[debug] [2025-03-21T07:54:47.085Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:54:47.089Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:54:47.089Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8094

[error] TypeError: express is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:51:13)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T07:54:47.346Z] Got response code 400; body Failed to generate manifest from function source: TypeError: express is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T07:54:56.783Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T07:54:56.784Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T07:54:57.786Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:54:58.198Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:54:58.198Z] Building nodejs source
[debug] [2025-03-21T07:54:58.198Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:54:58.198Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:54:58.199Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8988

[debug] [2025-03-21T07:54:58.492Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:54:58.498Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T07:54:58.498Z] [functions[us-central1-api]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/api).
[debug] [2025-03-21T07:55:03.549Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T07:55:03.549Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T07:55:04.551Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T07:55:04.950Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T07:55:04.950Z] Building nodejs source
[debug] [2025-03-21T07:55:04.950Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T07:55:04.950Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T07:55:04.951Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8652

[debug] [2025-03-21T07:55:05.197Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T07:55:05.202Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:17:41.181Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T08:17:42.188Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:17:43.834Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:17:43.834Z] Building nodejs source
[debug] [2025-03-21T08:17:43.834Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:17:43.835Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:17:43.836Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8908

[debug] [2025-03-21T08:17:44.200Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:17:44.207Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:18:01.320Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/audioProcessing.ts changed, reloading triggers
[debug] [2025-03-21T08:18:02.322Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:18:02.755Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:18:02.755Z] Building nodejs source
[debug] [2025-03-21T08:18:02.755Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:18:02.756Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:18:02.756Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8102

[debug] [2025-03-21T08:18:03.010Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:18:03.016Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:18:25.581Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T08:18:26.583Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:18:27.036Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:18:27.036Z] Building nodejs source
[debug] [2025-03-21T08:18:27.036Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:18:27.036Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:18:27.036Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8962

[debug] [2025-03-21T08:18:27.356Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:18:27.362Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:19:14.704Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T08:19:15.707Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:19:16.314Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:19:16.314Z] Building nodejs source
[debug] [2025-03-21T08:19:16.314Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:19:16.317Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:19:16.318Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8068

[debug] [2025-03-21T08:19:16.621Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:19:16.628Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:20:20.124Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package.json changed, reloading triggers
[debug] [2025-03-21T08:20:20.223Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package-lock.json changed, reloading triggers
[debug] [2025-03-21T08:20:21.225Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:20:21.655Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:20:21.655Z] Building nodejs source
[debug] [2025-03-21T08:20:21.655Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:20:21.656Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:20:21.657Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8018

[debug] [2025-03-21T08:20:21.964Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:20:21.970Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:20:26.199Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package.json changed, reloading triggers
[debug] [2025-03-21T08:20:26.300Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package-lock.json changed, reloading triggers
[debug] [2025-03-21T08:20:27.302Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:20:27.657Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:20:27.657Z] Building nodejs source
[debug] [2025-03-21T08:20:27.657Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:20:27.657Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:20:27.658Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8654

[debug] [2025-03-21T08:20:27.910Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:20:27.916Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:20:50.077Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T08:20:51.080Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:20:51.584Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:20:51.584Z] Building nodejs source
[debug] [2025-03-21T08:20:51.584Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:20:51.585Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:20:51.586Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8927

[debug] [2025-03-21T08:20:52.219Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:20:52.226Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:21:42.612Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T08:21:43.615Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:21:44.221Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:21:44.222Z] Building nodejs source
[debug] [2025-03-21T08:21:44.222Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:21:44.223Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:21:44.224Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8733

[debug] [2025-03-21T08:21:44.585Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:21:44.590Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:22:31.472Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T08:22:32.476Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:22:33.308Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:22:33.308Z] Building nodejs source
[debug] [2025-03-21T08:22:33.308Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:22:33.309Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:22:33.310Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8823

[debug] [2025-03-21T08:22:33.647Z] Got response from /__/functions.yaml {"endpoints":{"processAudioFile":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummary":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummary"},"testStorageAccess":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testStorageAccess"},"testDifyAPI":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"testDifyAPI"},"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"httpsTrigger":{},"entryPoint":"api"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:22:33.654Z] [functions] Loaded functions definitions from source: processAudioFile, createLessonSummary, testStorageAccess, testDifyAPI, api.
[debug] [2025-03-21T08:22:58.455Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:22:58.456Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:22:58.456Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:22:58.456Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:22:58.457Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:22:58.457Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:22:58.457Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:22:58.457Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:22:59.457Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:22:59.889Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:22:59.889Z] Building nodejs source
[debug] [2025-03-21T08:22:59.889Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:22:59.890Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:22:59.890Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8490

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:91:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:23:00.292Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:23:21.201Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/audioProcessing.ts changed, reloading triggers
[debug] [2025-03-21T08:23:22.207Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:23:22.645Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:23:22.645Z] Building nodejs source
[debug] [2025-03-21T08:23:22.645Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:23:22.645Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:23:22.646Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8623

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:91:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:23:22.987Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:23:59.194Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T08:24:00.198Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:24:00.694Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:24:00.694Z] Building nodejs source
[debug] [2025-03-21T08:24:00.694Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:24:00.695Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:24:00.696Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8017

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:91:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:24:01.003Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:24:10.685Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:10.686Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.686Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:10.686Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:24:10.786Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:11.787Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:24:12.184Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:24:12.184Z] Building nodejs source
[debug] [2025-03-21T08:24:12.184Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:24:12.184Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:24:12.185Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8985

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:24:12.482Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:24:16.522Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/audioProcessing.ts changed, reloading triggers
[debug] [2025-03-21T08:24:17.524Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:24:17.894Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:24:17.894Z] Building nodejs source
[debug] [2025-03-21T08:24:17.894Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:24:17.894Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:24:17.895Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8402

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:24:18.164Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:24:22.535Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.538Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:24:22.538Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:23.539Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:24:23.891Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:24:23.891Z] Building nodejs source
[debug] [2025-03-21T08:24:23.891Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:24:23.891Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:24:23.892Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8140

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:24:24.073Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:24:28.843Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.843Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:24:28.843Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:24:28.843Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:24:28.940Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:24:29.942Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:24:30.284Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:24:30.285Z] Building nodejs source
[debug] [2025-03-21T08:24:30.285Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:24:30.285Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:24:30.286Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8174

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:24:30.488Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:37:00.138Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:37:00.139Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:01.142Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:37:01.901Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:37:01.901Z] Building nodejs source
[debug] [2025-03-21T08:37:01.901Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:37:01.903Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:37:01.904Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8645

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:37:02.215Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:37:03.828Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:03.828Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.828Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.828Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:37:03.929Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:37:04.930Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:37:05.286Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:37:05.286Z] Building nodejs source
[debug] [2025-03-21T08:37:05.286Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:37:05.286Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:37:05.287Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8247

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:37:05.457Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:39:59.678Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T08:40:00.682Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:40:01.302Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:40:01.302Z] Building nodejs source
[debug] [2025-03-21T08:40:01.302Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:40:01.303Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:40:01.304Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8821

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:40:01.638Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:40:17.875Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T08:40:18.882Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:40:19.336Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:40:19.336Z] Building nodejs source
[debug] [2025-03-21T08:40:19.336Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:40:19.337Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:40:19.338Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8919

[error] TypeError: Cannot read properties of undefined (reading 'api_key')
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:48:55)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:93:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T08:40:19.610Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'api_key')
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T08:40:44.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:44.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:44.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:44.889Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:40:44.985Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:40:45.989Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:40:46.390Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:40:46.390Z] Building nodejs source
[debug] [2025-03-21T08:40:46.390Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:40:46.391Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:40:46.392Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8873

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:40:46.686Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:40:46.692Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummaryTest.
[debug] [2025-03-21T08:40:46.692Z] [functions[us-central1-createLessonSummaryTest]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/createLessonSummaryTest).
[debug] [2025-03-21T08:40:58.908Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T08:40:59.909Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:41:00.327Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:41:00.327Z] Building nodejs source
[debug] [2025-03-21T08:41:00.327Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:41:00.328Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:41:00.328Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8345

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:41:00.591Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:41:00.597Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummaryTest.
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:06.383Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:41:07.384Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:41:07.804Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:41:07.804Z] Building nodejs source
[debug] [2025-03-21T08:41:07.804Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:41:07.804Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:41:07.805Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8544

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:41:08.064Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:41:08.069Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummaryTest.
[debug] [2025-03-21T08:41:14.364Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:14.366Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.464Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.465Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:41:14.465Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:14.465Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:41:15.467Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:41:15.858Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:41:15.858Z] Building nodejs source
[debug] [2025-03-21T08:41:15.858Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:41:15.859Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:41:15.859Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8901

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:41:16.127Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:41:16.133Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummaryTest.
[debug] [2025-03-21T08:50:34.175Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T08:50:35.179Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:50:35.780Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:50:35.780Z] Building nodejs source
[debug] [2025-03-21T08:50:35.780Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:50:35.781Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:50:35.782Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8046

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:50:36.145Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:50:36.151Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, createLessonSummaryTest.
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:50:41.740Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:42.742Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:50:43.145Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:50:43.145Z] Building nodejs source
[debug] [2025-03-21T08:50:43.145Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:50:43.147Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:50:43.147Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8309

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:50:43.415Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:50:43.422Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T08:50:43.422Z] [functions[us-central1-generateSummaryFromTranscription]] function ignored because the firestore emulator does not exist or is not running.
[debug] [2025-03-21T08:50:50.117Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T08:50:50.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.118Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T08:50:50.119Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T08:50:51.121Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T08:50:51.542Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T08:50:51.542Z] Building nodejs source
[debug] [2025-03-21T08:50:51.542Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T08:50:51.543Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T08:50:51.544Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8716

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T08:50:51.814Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T08:50:51.820Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T08:59:59.025Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:00:00.045Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:00:00.739Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:00:00.739Z] Building nodejs source
[debug] [2025-03-21T09:00:00.739Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:00:00.739Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:00:00.740Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8514

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:00:01.165Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:00:01.172Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:00:07.000Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.001Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:00:07.001Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.001Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:00:07.001Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.001Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:07.099Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:00:08.102Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:00:08.505Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:00:08.505Z] Building nodejs source
[debug] [2025-03-21T09:00:08.505Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:00:08.507Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:00:08.508Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8763

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:00:08.784Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:00:08.790Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:00:08.790Z] DEBUG: Definition for trigger generateSummaryFromTranscription changed from {"eventType":"providers/cloud.firestore/eventTypes/document.update","resource":"projects/lesson-manager-99ab9/databases/(default)/documents/lessons/{lessonId}"} to {"eventType":"providers/cloud.firestore/eventTypes/document.update","resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"}
[debug] [2025-03-21T09:00:08.790Z] [functions[us-central1-generateSummaryFromTranscription]] function ignored because the firestore emulator does not exist or is not running.
[debug] [2025-03-21T09:00:15.780Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.781Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:15.781Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.781Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:15.781Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.782Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:15.880Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.881Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:15.881Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.881Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:15.881Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:00:15.881Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:00:16.884Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:00:17.317Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:00:17.317Z] Building nodejs source
[debug] [2025-03-21T09:00:17.317Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:00:17.318Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:00:17.319Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8579

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:00:17.597Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:00:17.603Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:03:53.125Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:03:54.132Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:03:54.772Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:03:54.773Z] Building nodejs source
[debug] [2025-03-21T09:03:54.773Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:03:54.773Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:03:54.774Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8396

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:03:55.104Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:03:55.110Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.760Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:02.822Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:04:02.822Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:03.823Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:04:04.267Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:04:04.267Z] Building nodejs source
[debug] [2025-03-21T09:04:04.268Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:04:04.268Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:04:04.268Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8481

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:04:04.537Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:04:04.543Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:04:12.852Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:04:12.854Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:04:13.856Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:04:14.322Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:04:14.322Z] Building nodejs source
[debug] [2025-03-21T09:04:14.322Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:04:14.326Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:04:14.327Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8108

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:04:14.624Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:04:14.636Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:12:08.371Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:12:09.375Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:12:10.221Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:12:10.221Z] Building nodejs source
[debug] [2025-03-21T09:12:10.221Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:12:10.221Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:12:10.222Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8715

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:12:10.553Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:12:10.560Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:12:23.446Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:12:24.447Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:12:24.867Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:12:24.867Z] Building nodejs source
[debug] [2025-03-21T09:12:24.867Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:12:24.868Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:12:24.868Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8000

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:12:25.135Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:12:25.141Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:12:31.634Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:12:31.635Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:32.637Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:12:33.055Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:12:33.055Z] Building nodejs source
[debug] [2025-03-21T09:12:33.055Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:12:33.055Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:12:33.056Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8368

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:12:33.318Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:12:33.324Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:12:39.311Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:12:40.312Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:12:40.741Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:12:40.741Z] Building nodejs source
[debug] [2025-03-21T09:12:40.741Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:12:40.742Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:12:40.743Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8023

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:12:41.018Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:12:41.024Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:34:56.121Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:34:57.127Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:34:58.732Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:34:58.734Z] Building nodejs source
[debug] [2025-03-21T09:34:58.734Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:34:58.735Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:34:58.736Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8025

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:34:59.115Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:34:59.124Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:35:03.886Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:04.888Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:35:05.291Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:35:05.291Z] Building nodejs source
[debug] [2025-03-21T09:35:05.291Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:35:05.291Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:35:05.292Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8409

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:35:05.501Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:35:05.508Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:35:12.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:35:12.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:35:12.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.956Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:35:12.957Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:35:13.960Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:35:14.423Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^11.11.1",
    "firebase-functions": "^4.5.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:35:14.423Z] Building nodejs source
[debug] [2025-03-21T09:35:14.423Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:35:14.423Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:35:14.424Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8080

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:35:14.607Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":300,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[debug] [2025-03-21T09:35:14.615Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T09:51:06.178Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package.json changed, reloading triggers
[debug] [2025-03-21T09:51:06.275Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/package-lock.json changed, reloading triggers
[debug] [2025-03-21T09:51:07.277Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:51:07.773Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:51:07.773Z] Building nodejs source
[debug] [2025-03-21T09:51:07.773Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:51:07.774Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:51:07.774Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8050

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:51:08.331Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:52:14.753Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:52:15.758Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:52:16.301Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:52:16.301Z] Building nodejs source
[debug] [2025-03-21T09:52:16.301Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:52:16.302Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:52:16.303Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8275

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:52:16.681Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:53:25.821Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:53:26.823Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:53:27.284Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:53:27.285Z] Building nodejs source
[debug] [2025-03-21T09:53:27.285Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:53:27.285Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:53:27.286Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8208

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:53:27.661Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:53:36.668Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:53:37.670Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:53:38.136Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:53:38.136Z] Building nodejs source
[debug] [2025-03-21T09:53:38.136Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:53:38.136Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:53:38.137Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8436

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:53:38.447Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:54:01.467Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T09:54:02.470Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:02.909Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:02.909Z] Building nodejs source
[debug] [2025-03-21T09:54:02.909Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:02.910Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:02.910Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8339

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:54:03.284Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:54:13.406Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T09:54:14.407Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:15.036Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:15.036Z] Building nodejs source
[debug] [2025-03-21T09:54:15.036Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:15.037Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:15.037Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8707

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T09:54:15.394Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T09:54:22.003Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.004Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:54:22.004Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.004Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:22.103Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:54:23.107Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:23.522Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:23.522Z] Building nodejs source
[debug] [2025-03-21T09:54:23.522Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:23.525Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:23.526Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8594

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:54:23.814Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T09:54:27.560Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T09:54:28.561Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:28.997Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:28.997Z] Building nodejs source
[debug] [2025-03-21T09:54:28.997Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:28.997Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:28.998Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8051

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:54:29.221Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T09:54:35.359Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T09:54:36.360Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:36.811Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:36.811Z] Building nodejs source
[debug] [2025-03-21T09:54:36.811Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:36.812Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:36.812Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8011

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:54:37.097Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T09:54:44.184Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T09:54:45.185Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:45.599Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:45.599Z] Building nodejs source
[debug] [2025-03-21T09:54:45.599Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:45.600Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:45.600Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8235

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:54:45.831Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:54:55.693Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:54:55.793Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.793Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:54:55.793Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:54:55.793Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:54:56.795Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:54:57.192Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:54:57.192Z] Building nodejs source
[debug] [2025-03-21T09:54:57.192Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:54:57.192Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:54:57.193Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8364

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:54:57.414Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T09:55:33.751Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T09:55:33.752Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.851Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T09:55:33.851Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T09:55:33.852Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T09:55:34.855Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T09:55:35.349Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T09:55:35.350Z] Building nodejs source
[debug] [2025-03-21T09:55:35.350Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T09:55:35.350Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T09:55:35.351Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8596

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T09:55:35.680Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:09:02.188Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T10:09:03.191Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:09:03.857Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:09:03.857Z] Building nodejs source
[debug] [2025-03-21T10:09:03.857Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:09:03.860Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:09:03.860Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8611

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T10:09:04.256Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:09:11.032Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T10:09:12.033Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:09:12.458Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:09:12.458Z] Building nodejs source
[debug] [2025-03-21T10:09:12.458Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:09:12.459Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:09:12.459Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8348

[error] {"severity":"WARNING","message":"params.openai.api_key.value() invoked during function deployment, instead of during runtime."}

[error] {"severity":"WARNING","message":"This is usually a mistake. In configs, use Params directly without calling .value()."}
{"severity":"WARNING","message":"example: { memory: memoryParam } not { memory: memoryParam.value() }"}

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T10:09:12.755Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:09:24.067Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:09:24.068Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:09:24.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:24.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:09:25.169Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:09:25.557Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:09:25.558Z] Building nodejs source
[debug] [2025-03-21T10:09:25.558Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:09:25.558Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:09:25.559Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8024

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:09:25.852Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:09:32.525Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:09:32.525Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.525Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.525Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:09:32.525Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:09:32.526Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:09:33.527Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:09:33.927Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:09:33.927Z] Building nodejs source
[debug] [2025-03-21T10:09:33.927Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:09:33.927Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:09:33.928Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8308

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:09:34.225Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:30:15.533Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:30:15.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:30:15.536Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.537Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:30:15.537Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:30:15.537Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.537Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.537Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:30:15.633Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:30:15.633Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:30:16.636Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:30:17.334Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:30:17.334Z] Building nodejs source
[debug] [2025-03-21T10:30:17.334Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:30:17.336Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:30:17.337Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8134

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:30:17.680Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:31:32.506Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:31:32.507Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:31:33.511Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:31:33.977Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:31:33.977Z] Building nodejs source
[debug] [2025-03-21T10:31:33.977Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:31:33.978Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:31:33.979Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8430

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:31:34.326Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:37:27.345Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T10:37:28.349Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:37:29.284Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:37:29.284Z] Building nodejs source
[debug] [2025-03-21T10:37:29.284Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:37:29.285Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:37:29.286Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8109

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:37:29.661Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:38:10.066Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T10:38:11.070Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:38:11.536Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:38:11.536Z] Building nodejs source
[debug] [2025-03-21T10:38:11.536Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:38:11.536Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:38:11.537Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8896

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:38:11.885Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:38:20.313Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T10:38:21.315Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:38:21.748Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:38:21.748Z] Building nodejs source
[debug] [2025-03-21T10:38:21.748Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:38:21.750Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:38:21.751Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8073

[info] Firebase Functions初期化、APIキー設定状態: v2で設定したOpenAI APIキーを使用します

[debug] [2025-03-21T10:38:22.059Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"openai.api_key","type":"string"}]}
[debug] [2025-03-21T10:38:28.404Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:38:28.405Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:38:29.407Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:38:29.847Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:38:29.847Z] Building nodejs source
[debug] [2025-03-21T10:38:29.847Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:38:29.848Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:38:29.849Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8857

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T10:38:30.168Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T10:38:45.590Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T10:38:46.592Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:38:47.017Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:38:47.017Z] Building nodejs source
[debug] [2025-03-21T10:38:47.017Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:38:47.017Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:38:47.018Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8346

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T10:38:47.377Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T10:38:52.876Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T10:38:53.877Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:38:54.278Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:38:54.278Z] Building nodejs source
[debug] [2025-03-21T10:38:54.278Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:38:54.278Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:38:54.279Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8140

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[error] TypeError: functions.runWith is not a function
    at Object.<anonymous> (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js:132:6)
    at Module._compile (node:internal/modules/cjs/loader:1364:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)
    at Module.load (node:internal/modules/cjs/loader:1203:32)
    at Module._load (node:internal/modules/cjs/loader:1019:12)
    at Module.require (node:internal/modules/cjs/loader:1231:19)
    at require (node:internal/modules/helpers:177:18)
    at loadModule (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:40:16)
    at loadStack (/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/runtime/loader.js:157:23)
    at /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/firebase-functions/lib/bin/firebase-functions.js:56:56

[debug] [2025-03-21T10:38:54.599Z] Got response code 400; body Failed to generate manifest from function source: TypeError: functions.runWith is not a function
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-03-21T10:39:00.042Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.043Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.137Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:39:00.137Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.137Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:39:00.137Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:00.137Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:39:01.139Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:39:01.579Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:39:01.579Z] Building nodejs source
[debug] [2025-03-21T10:39:01.579Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:39:01.579Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:39:01.580Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8872

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T10:39:01.889Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{}}
[debug] [2025-03-21T10:39:01.896Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.245Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T10:39:09.246Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T10:39:10.248Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T10:39:10.654Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T10:39:10.654Z] Building nodejs source
[debug] [2025-03-21T10:39:10.654Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T10:39:10.654Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T10:39:10.655Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8449

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T10:39:10.991Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{}}
[debug] [2025-03-21T10:39:10.997Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T11:17:41.190Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T11:17:42.204Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:17:42.853Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:17:42.853Z] Building nodejs source
[debug] [2025-03-21T11:17:42.853Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:17:42.855Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:17:42.856Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8983

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T11:17:43.306Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{}}
[debug] [2025-03-21T11:17:43.313Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T11:18:04.963Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/whisper.ts changed, reloading triggers
[debug] [2025-03-21T11:18:05.967Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:18:06.407Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:18:06.407Z] Building nodejs source
[debug] [2025-03-21T11:18:06.407Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:18:06.408Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:18:06.408Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8519

[info] Firebase Functions初期化、APIキー設定状態: OpenAI設定なし

[debug] [2025-03-21T11:18:06.753Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFile":{"platform":"gcfv1","availableMemoryMb":2048,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"google.storage.object.finalize","eventFilters":{"resource":"projects/_/buckets/lesson-manager-99ab9.firebasestorage.app"},"retry":false},"labels":{},"entryPoint":"processAudioFile"},"generateSummaryFromTranscription":{"platform":"gcfv1","availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.update","eventFilters":{"resource":"projects/lesson-manager-99ab9/databases/(default)/documents/users/{userId}/lessons/{lessonId}"},"retry":false},"labels":{},"entryPoint":"generateSummaryFromTranscription"},"createLessonSummaryTest":{"platform":"gcfv1","labels":{},"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"callableTrigger":{},"entryPoint":"createLessonSummaryTest"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{}}
[debug] [2025-03-21T11:18:06.760Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFile, generateSummaryFromTranscription, createLessonSummaryTest.
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:18:27.916Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:18:28.918Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:18:29.336Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:18:29.336Z] Building nodejs source
[debug] [2025-03-21T11:18:29.336Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:18:29.336Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:18:29.337Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8739

[debug] [2025-03-21T11:18:29.664Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:18:34.483Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/config.json changed, reloading triggers
[debug] [2025-03-21T11:18:35.485Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:18:35.891Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:18:35.891Z] Building nodejs source
[debug] [2025-03-21T11:18:35.891Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env.lesson-manager-99ab9. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:18:35.892Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:18:35.892Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8063

[debug] [2025-03-21T11:18:36.184Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:18:37.003Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/config.json changed, reloading triggers
[debug] [2025-03-21T11:18:38.005Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:18:38.344Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:18:38.344Z] Building nodejs source
[debug] [2025-03-21T11:18:38.344Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:18:38.345Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:18:38.345Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8474

[debug] [2025-03-21T11:18:38.572Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:19:26.601Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.602Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:26.602Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.602Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.602Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:19:26.603Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:19:27.606Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:19:27.985Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:19:27.985Z] Building nodejs source
[debug] [2025-03-21T11:19:27.985Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:19:27.986Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:19:27.987Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8883

[debug] [2025-03-21T11:19:28.322Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:20:58.352Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T11:20:59.358Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:20:59.819Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:20:59.819Z] Building nodejs source
[debug] [2025-03-21T11:20:59.819Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:20:59.820Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:20:59.821Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8764

[debug] [2025-03-21T11:21:00.407Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:21:00.418Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:21:00.418Z] addStorageTrigger {"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","resource":"lesson-manager-99ab9.firebasestorage.app","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"}}}
[debug] [2025-03-21T11:21:00.418Z] [functions[us-central1-processAudioFileV2]] storage function initialized.
[debug] [2025-03-21T11:21:00.418Z] [functions[us-central1-generateSummaryFromTranscriptionV2]] function ignored because the firestore emulator does not exist or is not running.
[debug] [2025-03-21T11:21:00.419Z] [functions[us-central1-createLessonSummaryTestV2]] http function initialized (http://127.0.0.1:5001/lesson-manager-99ab9/us-central1/createLessonSummaryTestV2).
[debug] [2025-03-21T11:21:05.573Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:05.574Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:21:06.576Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:21:06.969Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:21:06.969Z] Building nodejs source
[debug] [2025-03-21T11:21:06.969Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:21:06.970Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:21:06.972Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8082

[debug] [2025-03-21T11:21:07.253Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:21:07.259Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:13.836Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:21:13.837Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:21:14.838Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:21:15.226Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:21:15.226Z] Building nodejs source
[debug] [2025-03-21T11:21:15.226Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:21:15.227Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:21:15.228Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8191

[debug] [2025-03-21T11:21:15.521Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:21:15.527Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:24:00.627Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T11:24:01.631Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:24:02.363Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:24:02.363Z] Building nodejs source
[debug] [2025-03-21T11:24:02.363Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:24:02.365Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:24:02.365Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8104

[debug] [2025-03-21T11:24:02.723Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":3600,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:24:02.731Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:24:08.424Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:08.429Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:24:09.432Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:24:09.874Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:24:09.874Z] Building nodejs source
[debug] [2025-03-21T11:24:09.874Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:24:09.875Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:24:09.876Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8558

[debug] [2025-03-21T11:24:10.190Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:24:10.196Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.748Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:17.848Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:17.848Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.848Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:24:17.848Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:24:18.850Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:24:19.224Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:24:19.224Z] Building nodejs source
[debug] [2025-03-21T11:24:19.224Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:24:19.224Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:24:19.225Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8014

[debug] [2025-03-21T11:24:19.533Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:24:19.539Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:44:11.735Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T11:44:12.740Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:44:13.398Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:44:13.398Z] Building nodejs source
[debug] [2025-03-21T11:44:13.398Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:44:13.399Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:44:13.400Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8956

[debug] [2025-03-21T11:44:13.787Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:44:13.794Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T11:44:58.840Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:58.841Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:58.841Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.841Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:58.841Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.841Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T11:44:58.842Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T11:44:59.843Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T11:45:00.232Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T11:45:00.232Z] Building nodejs source
[debug] [2025-03-21T11:45:00.232Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T11:45:00.233Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T11:45:00.234Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8687

[debug] [2025-03-21T11:45:00.577Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T11:45:00.583Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T13:35:13.865Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:13.866Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T13:35:13.867Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T13:35:14.870Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T13:35:15.806Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T13:35:15.806Z] Building nodejs source
[debug] [2025-03-21T13:35:15.806Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T13:35:15.808Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T13:35:15.809Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8200

[debug] [2025-03-21T13:35:16.184Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T13:35:16.195Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T13:37:51.810Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.811Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.811Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T13:37:51.811Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T13:37:51.910Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T13:37:51.910Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T13:37:51.910Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.910Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T13:37:51.910Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.911Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.911Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T13:37:51.911Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T13:37:52.915Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T13:37:53.324Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T13:37:53.324Z] Building nodejs source
[debug] [2025-03-21T13:37:53.324Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T13:37:53.325Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T13:37:53.328Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8329

[debug] [2025-03-21T13:37:53.666Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T13:37:53.672Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T13:40:15.425Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T13:40:15.427Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T13:40:16.430Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T13:40:17.327Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T13:40:17.327Z] Building nodejs source
[debug] [2025-03-21T13:40:17.327Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T13:40:17.329Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T13:40:17.330Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8710

[debug] [2025-03-21T13:40:17.668Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T13:40:17.673Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:08:25.354Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.355Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.357Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T14:08:25.357Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T14:08:26.360Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:08:27.012Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:08:27.012Z] Building nodejs source
[debug] [2025-03-21T14:08:27.012Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:08:27.014Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:08:27.015Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8625

[debug] [2025-03-21T14:08:27.439Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:08:27.448Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:15:17.730Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/audioProcessing.ts changed, reloading triggers
[debug] [2025-03-21T14:15:18.736Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:15:19.476Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:15:19.476Z] Building nodejs source
[debug] [2025-03-21T14:15:19.476Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:15:19.477Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:15:19.478Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8605

[debug] [2025-03-21T14:15:19.847Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:15:19.854Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:15:38.045Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/audioProcessing.ts changed, reloading triggers
[debug] [2025-03-21T14:15:39.047Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:15:39.488Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:15:39.488Z] Building nodejs source
[debug] [2025-03-21T14:15:39.488Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:15:39.489Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:15:39.489Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8351

[debug] [2025-03-21T14:15:39.791Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:15:39.797Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:15:52.509Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/index.ts changed, reloading triggers
[debug] [2025-03-21T14:15:53.512Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:15:53.942Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:15:53.942Z] Building nodejs source
[debug] [2025-03-21T14:15:53.942Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:15:53.944Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:15:53.945Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8308

[debug] [2025-03-21T14:15:54.344Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:15:54.350Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T14:16:07.167Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T14:16:08.169Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:16:08.603Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:16:08.603Z] Building nodejs source
[debug] [2025-03-21T14:16:08.603Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:16:08.605Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:16:08.605Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 9000

[debug] [2025-03-21T14:16:08.903Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:16:08.908Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:23:42.252Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/src/dify.ts changed, reloading triggers
[debug] [2025-03-21T14:23:43.261Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:23:43.881Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:23:43.881Z] Building nodejs source
[debug] [2025-03-21T14:23:43.881Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:23:43.883Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:23:43.885Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8167

[debug] [2025-03-21T14:23:44.255Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:23:44.262Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
[debug] [2025-03-21T14:24:43.680Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js changed, reloading triggers
[debug] [2025-03-21T14:24:43.680Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js changed, reloading triggers
[debug] [2025-03-21T14:24:43.680Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js changed, reloading triggers
[debug] [2025-03-21T14:24:43.680Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/utils.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/audioProcessing.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/whisper.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/config.js changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/dify.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js.map changed, reloading triggers
[debug] [2025-03-21T14:24:43.681Z] DEBUG: File /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/lib/index.js changed, reloading triggers
[debug] [2025-03-21T14:24:44.683Z] Validating nodejs source
[warn] ⚠  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] ⚠  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-03-21T14:24:45.091Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "lint": "echo 'Skipping lint'",
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "@ffmpeg-installer/ffmpeg": "^1.1.0",
    "@types/express": "^5.0.0",
    "axios": "^1.6.7",
    "express": "^4.21.2",
    "firebase-admin": "^13.2.0",
    "firebase-functions": "^6.3.2",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.2",
    "fs-extra": "^11.3.0",
    "openai": "^4.36.0"
  },
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/form-data": "^2.2.1",
    "@types/fs-extra": "^11.0.4",
    "@typescript-eslint/eslint-plugin": "^6.19.1",
    "@typescript-eslint/parser": "^6.19.1",
    "eslint": "^8.56.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-import": "^2.29.1",
    "firebase-functions-test": "^3.1.1",
    "typescript": "^5.3.3"
  },
  "private": true
}
[debug] [2025-03-21T14:24:45.091Z] Building nodejs source
[debug] [2025-03-21T14:24:45.091Z] Failed to find version of module node: reached end of search path /Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules
[info] ✔  functions: Using node@18 from host. 
[info] i  functions: Loaded environment variables from .env, .env.lesson-manager-99ab9, .env.local. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-03-21T14:24:45.093Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-03-21T14:24:45.093Z] Found firebase-functions binary at '/Users/miyakoshiyuuki/lesson-manager-googleBKU/functions/node_modules/.bin/firebase-functions'
[info] Serving at port 8107

[debug] [2025-03-21T14:24:45.523Z] Got response from /__/functions.yaml {"endpoints":{"healthCheck":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"httpsTrigger":{},"entryPoint":"healthCheck"},"processAudioFileV2":{"platform":"gcfv2","availableMemoryMb":4096,"timeoutSeconds":540,"minInstances":null,"maxInstances":10,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.storage.object.v1.finalized","eventFilters":{"bucket":"lesson-manager-99ab9.firebasestorage.app"},"retry":false},"entryPoint":"processAudioFileV2"},"generateSummaryFromTranscriptionV2":{"availableMemoryMb":1024,"timeoutSeconds":540,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["asia-northeast1"],"labels":{},"eventTrigger":{"eventType":"google.cloud.firestore.document.v1.updated","eventFilters":{"database":"(default)","namespace":"(default)"},"eventFilterPathPatterns":{"document":"users/{userId}/lessons/{lessonId}"},"retry":false},"entryPoint":"generateSummaryFromTranscriptionV2"},"createLessonSummaryTestV2":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","region":["us-central1"],"labels":{},"callableTrigger":{},"entryPoint":"createLessonSummaryTestV2"}},"specVersion":"v1alpha1","requiredAPIs":[],"extensions":{},"params":[{"name":"OPENAI_API_KEY","type":"string"}]}
[debug] [2025-03-21T14:24:45.547Z] [functions] Loaded functions definitions from source: healthCheck, processAudioFileV2, generateSummaryFromTranscriptionV2, createLessonSummaryTestV2.
